!function(){var Autocompletionist;Autocompletionist=function(options){var self=this;self.options=options;self.addMatch=function(match){self.matches.push(match);self.numberOfMatches+=1;var item=$('<li class="'+self.itemCssClass+'">'+match+"</li>");self.$list.append(item);self.$list.show();self.visible=true};self.clearListItems=function(){if(!self.$list){return}self.hide();self.$list.find("."+self.itemCssClass).remove()};self.decrementSelectedItemIndex=function(){if(self.selectedItemIndex>0){self.selectedItemIndex-=1;self.selectedItemValue=self.matches[self.selectedItemIndex];self.$list.find("."+self.itemCssClass).removeClass("selected");self.$list.find("."+self.itemCssClass+":nth("+self.selectedItemIndex+")").addClass("selected")}};self.ensureValidSearchTerm=function(term){return(term||"").toString().toLowerCase()};self.findMatches=function(term){term=self.ensureValidSearchTerm(term);self.initializeMatches();if(term===""){return self.matches}for(var i=0;i<self.numberOfKeys;i+=1){var lowerCaseKey=self.lowerCaseKeys[i];if(lowerCaseKey.indexOf(term)===0){var key=self.keys[i];self.logger.debug("Found match for term '"+term+"': "+self.keys[i]);self.addMatch(key)}}self.selectFirstItemInList();return self.matches};self.hide=function(){self.visible=false;self.$list.hide()};self.incrementSelectedItemIndex=function(){if(self.selectedItemIndex<self.numberOfMatches-1){self.selectedItemIndex+=1;self.selectedItemValue=self.matches[self.selectedItemIndex];self.$list.find("."+self.itemCssClass).removeClass("selected");self.$list.find("."+self.itemCssClass+":nth("+self.selectedItemIndex+")").addClass("selected")}};self.initialize=function(){self.keys=self.options.keys||[];self.numberOfKeys=self.keys.length;self.listCssClass="query-parser-autocomplete-list";self.itemCssClass="query-parser-autocomplete-item";self.visible=false;self.$selector=self.options.selector;self.initializeLogger();self.initializeLowerCaseKeys();self.initializeMatches();self.initializeList()};self.initializeList=function(){self.options.$selector.wrap("<div></div>");var $wrapper=self.options.$selector.parent();$wrapper.addClass("query-parser-autocomplete-wrapper");self.$list=$('<ul class="'+self.listCssClass+'"></ul>');var top=self.options.$selector.position().top+self.options.$selector.height()+parseInt(self.options.$selector.css("padding-top"),10)+parseInt(self.options.$selector.css("padding-bottom"),10)+parseInt(self.options.$selector.css("border-top-width"),10)+parseInt(self.options.$selector.css("border-bottom-width"),10);var left=self.options.$selector.position().left;self.$list.css("top",top);self.$list.css("left",left);self.$list.hide();$wrapper.append(self.$list)};self.initializeLogger=function(){self.logger=new window.QueryParser.Logger("Autocompletionist",self.options.debug);self.logger.debug("Creating new Autocompletionist instance")};self.initializeLowerCaseKeys=function(){self.lowerCaseKeys=[];for(var i=0;i<self.numberOfKeys;i+=1){var key=self.keys[i].toString().toLowerCase();self.lowerCaseKeys.push(key)}return self.lowerCaseKeys};self.initializeMatches=function(){self.matches=[];self.numberOfMatches=0;self.selectedItemValue="";self.selectedItemIndex=-1;self.clearListItems()};self.selectFirstItemInList=function(){if(self.numberOfMatches>0){self.selectedItemIndex=0;self.selectedItemValue=self.matches[0];self.$list.find("."+self.itemCssClass+":first").addClass("selected")}};self.initialize()};if(!window.QueryParser){window.QueryParser={}}window.QueryParser.Autocompletionist=Autocompletionist}();!function(){var Log,Logger;Log=function(name,level,message){var self=this;self.level=level;self.message=message;self.name=name;self.timestamp=new Date;self.toString=function(){return self.name+" -- "+self.timestamp.toString()+" ["+self.level+"] "+self.message}};Logger=function(name,isDebugging){var self=this;self.isDebugging=isDebugging;self.logs=[];self.name=name;self.debug=function(message){self.log("debug",message)};self.error=function(message){self.log("error",message)};self.initialize=function(){self.writeToConsoleEnabled=self.isDebugging&&window.console&&window.console.log};self.log=function(level,message){var log=new Log(self.name,"debug",message);self.logs.push(log);if(self.writeToConsoleEnabled){window.console.log(log.toString())}return log};self.initialize()};if(!window.QueryParser){window.QueryParser={}}window.QueryParser.Logger=Logger}();!function(){var Query;Query=function(options){var self=this;self.options=options;self.initialize=function(){self.logger=new window.QueryParser.Logger("Query",options.debug);self.$output=null;self.hasOutputSelector=false;self.lastQuerySegment=null;self.queryPartDelimiters=self.options.queryPartDelimiters;self.querySegments=[];self.queryString="";if(self.options.outputSelector){self.hasOutputSelector=true;self.$output=$(self.options.outputSelector)}};self.onQueryStringUpdated=function(){self.splitQueryStringIntoParts();if(self.hasOutputSelector){self.$output.html(self.toString())}};self.setCurrentTerm=function(value){self.currentTerm=value;self.queryUpdatedCallback(value)};self.setQueryUpdatedCallback=function(value){self.queryUpdatedCallback=value};self.splitQueryStringIntoParts=function(){var i,len,queryPart,queryParts,querySegment;self.querySegments=[];queryParts=self.queryString.split(self.queryPartDelimiters);for(i=0,len=queryParts.length;i<len;i+=1){queryPart=queryParts[i];querySegment=new window.QueryParser.QuerySegment(queryPart);self.querySegments.push(querySegment);self.lastQuerySegment=querySegment}self.setCurrentTerm(self.lastQuerySegment.term)};self.setQueryString=function(value){self.queryString=value;self.onQueryStringUpdated()};self.toString=function(){var i,output,querySegment;output="";output+="Query String: "+self.queryString+self.options.newline;output+="Query Segments: "+self.options.newline;for(i=0,len=self.querySegments.length;i<len;i+=1){querySegment=self.querySegments[i];output+=i+": "+querySegment.toString()+self.options.newline}return output};self.initialize()};if(!window.QueryParser){window.QueryParser={}}window.QueryParser.Query=Query}();!function(){var QueryParser;var options={debug:false,keys:[],newline:"<br/>",outputSelector:null,queryPartDelimiters:/\s(?:and|or)\s/i};QueryParser=function(selector,userOptions){var self=this;$.extend(options,userOptions);self.options=options;self.$selector=$(selector);self.autocomplete=function(){var content,currentTermLength,queryStringLength,uneditedQueryPart;if(self.autocompletionist.selectedItemValue){queryStringLength=self.queryString.length;currentTermLength=self.query.currentTerm.length;uneditedQueryPart=self.queryString.substr(0,queryStringLength-currentTermLength);content=uneditedQueryPart+self.autocompletionist.selectedItemValue+" ";self.$selector.val(content);self.setQueryString(content);return content}};self.bindEvents=function(){self.$selector.on("focus keyup",function(){self.parseQuery()});self.$selector.on("blur",function(){self.autocompletionist.hide()});self.$selector.on("keydown",self.onKeydown)};self.getCurrentTerm=function(){return self.query.currentTerm};self.initialize=function(){self.options.$selector=self.$selector;self.initializeLogger();self.queryString="";self.query=new window.QueryParser.Query(self.options);self.query.setQueryUpdatedCallback(self.onQueryUpdated);self.autocompletionist=new window.QueryParser.Autocompletionist(self.options);self.isQueryStringUpdated=false;self.keyEvents={9:{callback:self.onTabPressed,name:"Tab"},13:{callback:self.onEnterPressed,name:"Enter"},27:{callback:self.onEscapePressed,name:"Escape"},38:{callback:self.onUpArrowPressed,name:"Up Arrow"},40:{callback:self.onDownArrowPressed,name:"Down Arrow"}};self.bindEvents()};self.initializeLogger=function(){self.logger=new window.QueryParser.Logger("QueryParser",self.options.debug);self.logger.debug("Creating new QueryParser instance.")};self.onDownArrowPressed=function(){self.autocompletionist.incrementSelectedItemIndex();return false};self.onEnterPressed=function(){self.autocomplete();return false};self.onEscapePressed=function(){self.logger.debug("Escape was pressed. Hiding autocomplete.");self.autocompletionist.hide();return false};self.onKeydown=function(event){var key,keyEvent;key=event.which;self.logger.debug("Keydown: "+key);keyEvent=self.keyEvents[key];if(keyEvent){return keyEvent.callback()}else{self.isQueryStringUpdated=true;return true}};self.onQueryUpdated=function(term){self.autocompletionist.findMatches(term)};self.onTabPressed=function(){self.autocomplete();return false};self.onUpArrowPressed=function(){self.autocompletionist.decrementSelectedItemIndex();return false};self.parseQuery=function(){if(self.isQueryStringUpdated){var content=self.$selector.val();self.setQueryString(content);self.isQueryStringUpdated=false}};self.setQueryString=function(value){self.queryString=value;self.query.setQueryString(value)};self.initialize()};if(!window.QueryParser){window.QueryParser={}}window.QueryParser.QueryParser=QueryParser}();!function(){var QuerySegment;QuerySegment=function(queryPart){var self=this;self.queryPart=queryPart;self.initialize=function(){self.comparators=/(=|<>|!=|>|>=|<|<=|in)/i;self.comparator=null;self.comparatorIndex=null;self.key=null;self.term=null;self.value=null;self.parseQuerySegment()};self.parseQuerySegment=function(){var parts=self.queryPart.split(self.comparators);self.parseTerm();if(parts.length>1){self.key=parts[0].trim();self.comparator=parts[1].trim();self.value=parts[2].trim()}};self.parseTerm=function(){var numberOfSplits,splitByCharacters;self.term=self.queryPart;splitByCharacters=self.term.split(/\s|\(|<|>|=/);numberOfSplits=splitByCharacters.length;if(numberOfSplits>1&&splitByCharacters[numberOfSplits-1]===""){self.term="";return self.term}while(numberOfSplits>1&&splitByCharacters[0]===""){splitByCharacters=splitByCharacters.splice(1,numberOfSplits-1);numberOfSplits=splitByCharacters.length;self.term=splitByCharacters[0]}return self.term};self.toString=function(){return"Key: "+self.key+", Comparator: "+self.comparator+", Value: "+self.value};self.initialize()};if(!window.QueryParser){window.QueryParser={}}window.QueryParser.QuerySegment=QuerySegment}();